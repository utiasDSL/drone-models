<mujoco model="cf2">
  <compiler inertiafromgeom="false" meshdir="assets" autolimits="true" />

  <asset>
    <material name="black" rgba="0.102 0.102 0.102 1"/>
    <material name="gray" rgba="0.3 0.3 0.3 1"/>
    <material name="light-gray" rgba="0.7 0.7 0.7 1"/>
    <material name="silver" rgba="0.898 0.898 0.898 1"/>
    <material name="white" rgba="1 1 1 0.3"/>
    <material name="gold" rgba="0.969 0.878 0.6 1"/>

    <mesh name="pcb" file="cf2x/cf2x_pcb.stl" scale="0.001 0.001 0.001"/>
    <mesh name="motors" file="cf2x/cf2xP_motors.stl" scale="0.001 0.001 0.001"/>
    <mesh name="motor-holder" file="cf2x/cf2x_motor-holder.stl" scale="0.001 0.001 0.001"/>
    <mesh name="propL" file="cf2x/cf2xP_PropL.stl" scale="0.001 0.001 0.001"/>
    <mesh name="propR" file="cf2x/cf2xP_PropR.stl" scale="0.001 0.001 0.001"/>
    <mesh name="connectors" file="cf2x/cf2x_connectors.stl" scale="0.001 0.001 0.001"/>
    <mesh name="connector-pins" file="cf2x/cf2x_connector-pins.stl" scale="0.001 0.001 0.001"/>
    <mesh name="battery" file="cf2x/cf2x_battery.stl" scale="0.001 0.001 0.001"/>
    <mesh name="battery-holder" file="cf2x/cf2x_battery-holder.stl" scale="0.001 0.001 0.001"/>
  </asset>


  <default>
    <default class="cf2">
      <default class="visual">
        <geom group="2" type="mesh" contype="0" conaffinity="0" />
      </default>
      <default class="collision">
        <geom group="3" condim="1" />
      </default>
      <site group="5" />
    </default>
  </default>

  <worldbody>
    <body name="drone" pos="0 0 0.05" childclass="cf2">
      <inertial pos="0.0 0.0 0.0" mass="0.027" diaginertia="2.3951e-5 2.3951e-5 3.2347e-5" />
      <camera name="track" pos="-1 0 .5" xyaxes="0 -1 0 1 0 2" mode="trackcom" />
      <geom mesh="pcb" material="gray" class="visual" />
      <geom mesh="motors" material="silver" class="visual" />
      <geom mesh="motor-holder" material="white" class="visual" />
      <geom mesh="connectors" material="black" class="visual" />
      <geom mesh="connector-pins" material="gold" class="visual" />
      <geom mesh="battery" material="light-gray" class="visual" />
      <geom mesh="battery-holder" material="black" class="visual" />
      <!-- Collision geometry is estimated based on the visual mesh. We use a sphere for maximum
       computational efficiency with larger swarms. -->
      <geom type="sphere" size="0.055" class="collision" name="col" />
      <site name="CoM" />
      <site name="motor0" pos="0.0325 -0.0325 0.0" />
      <site name="motor1" pos="-0.0325 -0.0325 0.0" />
      <site name="motor2" pos="-0.0325 0.0325 0.0" />
      <site name="motor3" pos="0.0325 0.0325 0.0" />

      <!-- Propellers -->
      <body name="prop0" pos="0.0325 -0.0325 0.012" euler="0 0 45">
        <geom mesh="propL" material="black" class="visual"/>
      </body>
      <body name="prop1" pos="-0.0325 -0.0325 0.012" euler="0 0 135">
        <geom mesh="propR" material="black" class="visual"/>
      </body>
      <body name="prop2" pos="-0.0325 0.0325 0.012" euler="0 0 225">
        <geom mesh="propL" material="black" class="visual"/>
      </body>
      <body name="prop3" pos="0.0325 0.0325 0.012" euler="0 0 315">
        <geom mesh="propR" material="black" class="visual"/>
      </body>

    </body>
  </worldbody>

  <!-- Actuators 
  We do not limit the actuation range of the motors here, because we would need to synchronize the
  control limits from our constants module with the ones in the MuJoCo model. Instead, we rely on
  the controller simulation for proper clipping. 
  -->
  <actuator>
    <motor gear="0 0 1 0 0 0" site="motor0" name="motor0_force" />
    <motor gear="0 0 1 0 0 0" site="motor1" name="motor1_force" />
    <motor gear="0 0 1 0 0 0" site="motor2" name="motor2_force" />
    <motor gear="0 0 1 0 0 0" site="motor3" name="motor3_force" />
    <motor gear="0 0 0 0 0 1" site="motor0" name="motor0_torque" />
    <motor gear="0 0 0 0 0 1" site="motor1" name="motor1_torque" />
    <motor gear="0 0 0 0 0 1" site="motor2" name="motor2_torque" />
    <motor gear="0 0 0 0 0 1" site="motor3" name="motor3_torque" />
  </actuator>

  <!-- Model Parameters
  Below are all the parameters unique to the drone setup
  Base is the Crazyflie 2.X, file name encodes the specific setup
  - Propellers/Motors options: L(egacy), P(lus), T(hrust upgrade kit), B(rushless) 
  - Battery (250mAh / 350mAh)
  -->
  <custom>
    <!-- Physical Parameters-->
    <numeric name="gravity" data="9.807" /> <!-- Munich, Germany-->
    <numeric name="mass" data="0.03454" />
    <numeric name="J" data="1.4e-5 0.0    0.0 
                            0.0    1.4e-5 0.0
                            0.0    0.0    2.17e-5"/> <!-- From IROS 2022 -->
    <!-- <numeric name="J" data="1.68e-5 0.0    0.0 
                            0.0    1.68e-5 0.0
                            0.0    0.0    2.98e-5" />  --> <!-- From FÃ¶rster B.S. thesis -->
    <!-- Distance of motor from axis 
         in x configuration, it's 1/sqrt(2) smaller 
         arm "+" = 0.046 (from CAD); arm "x" = 0.03253 (rounded)-->
    <numeric name="arm" data="0.03253" />
    <!-- Matrix on how to mix the forces into torques, different for "x" and "+" config-->
    <numeric name="sign_matrix" data="-1 -1 -1 
                                      -1  1  1 
                                       1  1 -1 
                                       1 -1  1" />
    <numeric name="prop_radius" data="2.31348e-2" />

    <!-- Motors and Thrust-->
    <numeric name="PWM_MIN" data="20000.0" />
    <numeric name="PWM_MAX" data="65535.0" />
    <numeric name="THRUST_MIN" data="0.02" /> <!-- in N, per motor-->
    <numeric name="THRUST_MAX" data="0.1125" /> <!-- in N, per motor-->
    <numeric name="THRUST_TAU" data="7.2333515424212695" />
    <numeric name="VMOTOR_MIN" data="0.9857578735524497" /> <!-- in V-->
    <numeric name="VMOTOR_MAX" data="2.9966889966322077" /> <!-- in V-->
    <numeric name="p_vmotor2thrust" data="-0.02427920377129026 0.06433042290821364 -0.026401054210489865 0.006731877887386432" /> <!--Index is order-->
    <numeric name="p_vmotor2rpm" data="4741.994550959416 7472.9374014021605" /> <!--Index is order-->
    <numeric name="kf" data="5.792654323957372e-10" />
    <numeric name="km" data="7.94e-12" /> <!-- From old identification! TODO: Replace if possible-->

    <!-- System Idenfication: Simple Model-->
    <numeric name="SI_roll" data="-3.96 4.08" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="SI_pitch" data="-6.00 6.21" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="SI_yaw" data="0.0 0.0" /> <!-- Not Identified!-->
    <numeric name="SI_acc" data="20.907574256269616 3.653687545690674" /> <!-- From identification for L250! TODO: Redo -->

    <!-- System Identification: Double Integrator Model-->
    <numeric name="DI_roll" data="-99.94 -13.3 84.73" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_pitch" data="-130.3 -16.33 119.3" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_yaw" data="0.0 0.0 0.0" />  <!-- Not Identified!-->
    <numeric name="DI_acc" data="20.907574256269616 3.653687545690674" /> <!-- From identification for L250! TODO: Redo -->

    <!-- System Identification: Double Integrator Model with delay-->
    <numeric name="DI_D_roll" data="-286.2 -23.03 225.6" /><!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_D_pitch" data="-286.2 -23.03 225.6" /><!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_D_yaw" data="-192.9 -22.22 323.5" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_D_acc" data="0.1670 0.5615 0.0654" /> <!--Index is order, tau is last-->

    <!-- System Identification: Double Integrator Model with drag and delay-->
    <numeric name="DI_DD_roll" data="-257.2 -20.2 207.1" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_DD_pitch" data="-257.2 -20.2 207.1" /> <!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_DD_yaw" data="-225.3 -28.61 392.7" />  <!-- From identification for L250! TODO: Redo -->
    <numeric name="DI_DD_acc" data="1.0627 0.1891 -0.0177 0.0010" /> <!--c1, tau, c2, c3-->  <!-- From identification for L250! TODO: Redo -->

  </custom>

</mujoco>